<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trophy Collector Pro</title>

<style>
:root {
    --bg:#f5f5f7;
    --dark:#1d1d1f;
    --accent:#0071e3;
    --win:#ffcc00;
}
body{
    margin:0;height:100vh;display:flex;justify-content:center;align-items:center;
    font-family:-apple-system,sans-serif;background:var(--bg);overflow:hidden;
}
body.playing{background:#111;}
body.won{background:#fff9e6;}

#trophy-shelf{
    position:fixed;top:0;width:100%;height:80px;
    display:flex;gap:20px;align-items:center;padding:0 20px;
    background:white;border-bottom:3px solid var(--win);
    transform:translateY(-100%);transition:.5s;z-index:99;
}
body.has-trophies #trophy-shelf{transform:translateY(0);}
.mini-trophy-item{
    width:45px;height:45px;border-radius:8px;
    border:2px solid gold;background-size:cover;
    box-shadow:0 0 15px gold;
}

.main-container{
    display:flex;flex-direction:column;gap:20px;align-items:center;
}

.upload-box{
    width:300px;height:300px;border-radius:24px;
    background:white;display:flex;justify-content:center;align-items:center;
    box-shadow:0 10px 30px rgba(0,0,0,.1);
    cursor:pointer;position:relative;
    transition:.3s;
}
.upload-box.dragover{
    outline:4px dashed var(--accent);
    transform:scale(1.03);
}
.box-ui{
    text-align:center;color:#888;
    background-size:cover;background-position:center;
    width:100%;height:100%;display:flex;
    flex-direction:column;justify-content:center;align-items:center;
    border-radius:24px;
}

.puzzle-piece{
    width:100px;height:100px;float:left;
    background-size:300px 300px;
    display:none;
}
body.puzzle-mode .puzzle-piece{display:block;}
body.puzzle-mode .box-ui{display:none;}

.apple-btn{
    padding:12px 28px;border:none;border-radius:999px;
    font-weight:600;cursor:pointer;
    background:var(--accent);color:white;
}
#save-btn{
    display:none;background:var(--win);
}

#file-input{display:none;}
</style>
</head>

<body>

<div id="trophy-shelf"></div>

<div class="main-container">
    <div class="upload-box" id="drop-zone">
        <div class="box-ui" id="box-ui">
            <div style="font-size:48px">ï¼‹</div>
            <div>drop or click image</div>
        </div>
    </div>

    <button class="apple-btn" onclick="togglePuzzle()">Split Image</button>
    <button class="apple-btn" onclick="startGame()">Play</button>
    <button id="save-btn" class="apple-btn" onclick="saveTrophy()">Save Trophy</button>
</div>

<input type="file" id="file-input" accept="image/*">

<script>
let solution=[],currentImg="",isPlaying=false;

const dz=document.getElementById("drop-zone");
const fileInput=document.getElementById("file-input");

dz.onclick=()=>fileInput.click();

fileInput.onchange=e=>{
    if(e.target.files[0]) loadFile(e.target.files[0]);
};

dz.addEventListener("dragover",e=>{
    e.preventDefault();dz.classList.add("dragover");
});
dz.addEventListener("dragleave",()=>dz.classList.remove("dragover"));

dz.addEventListener("drop",e=>{
    e.preventDefault();dz.classList.remove("dragover");

    if(e.dataTransfer.files.length){
        loadFile(e.dataTransfer.files[0]);
    } else {
        const html=e.dataTransfer.getData("text/html");
        const src=html.match(/src\s*=\s*"(.+?)"/);
        if(src) loadImageFromURL(src[1]);
    }
});

function loadFile(file){
    const reader=new FileReader();
    reader.onload=e=>useImage(e.target.result);
    reader.readAsDataURL(file);
}

function loadImageFromURL(url){
    fetch(url)
        .then(r=>r.blob())
        .then(b=>loadFile(b));
}

function useImage(img){
    currentImg=img;
    const ui=document.getElementById("box-ui");
    ui.style.backgroundImage=`url('${img}')`;
    ui.innerHTML="";
    createPieces(img);
}

function createPieces(img){
    dz.querySelectorAll(".puzzle-piece").forEach(p=>p.remove());
    solution=[];
    for(let i=0;i<9;i++){
        const p=document.createElement("div");
        p.className="puzzle-piece";
        const pos=`${(i%3)*50}% ${Math.floor(i/3)*50}%`;
        solution.push(pos);
        p.style.backgroundImage=`url('${img}')`;
        p.style.backgroundPosition=pos;
        p.draggable=true;
        p.ondragstart=e=>e.dataTransfer.setData("id",i);
        p.ondrop=e=>{
            e.preventDefault();
            const j=e.dataTransfer.getData("id");
            const other=dz.querySelectorAll(".puzzle-piece")[j];
            [p.style.backgroundPosition,other.style.backgroundPosition]=
            [other.style.backgroundPosition,p.style.backgroundPosition];
            checkWin();
        };
        p.ondragover=e=>e.preventDefault();
        dz.appendChild(p);
    }
}

function togglePuzzle(){
    document.body.classList.toggle("puzzle-mode");
}

function startGame(){
    document.body.classList.add("playing");
    const pos=[...solution].sort(()=>Math.random()-.5);
    dz.querySelectorAll(".puzzle-piece").forEach((p,i)=>p.style.backgroundPosition=pos[i]);
}

function checkWin(){
    const now=[...dz.querySelectorAll(".puzzle-piece")].map(p=>p.style.backgroundPosition);
    if(JSON.stringify(now)===JSON.stringify(solution)){
        document.body.classList.add("won");
        document.getElementById("save-btn").style.display="block";
    }
}

function saveTrophy(){
    const t=document.createElement("div");
    t.className="mini-trophy-item";
    t.style.backgroundImage=`url('${currentImg}')`;
    document.getElementById("trophy-shelf").appendChild(t);
    document.body.classList.add("has-trophies");
}
</script>

</body>
</html>

