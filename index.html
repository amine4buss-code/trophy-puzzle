<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trophy Collector Pro</title>

<style>
:root{
    --bg:#f5f5f7;
    --accent:#0071e3;
    --win:#ffcc00;
}
body{
    margin:0;height:100vh;display:flex;justify-content:center;align-items:center;
    font-family:-apple-system,sans-serif;background:var(--bg);
}
body.puzzle-mode{background:#111;}
body.won{background:#fff9e6;}

#trophy-shelf{
    position:fixed;top:0;width:100%;height:80px;
    display:flex;gap:20px;align-items:center;padding:0 20px;
    background:white;border-bottom:3px solid var(--win);
    transform:translateY(-100%);transition:.4s;z-index:10;
}
body.has-trophies #trophy-shelf{transform:translateY(0);}
.mini-trophy-item{
    width:45px;height:45px;border-radius:8px;
    border:2px solid gold;background-size:cover;
    box-shadow:0 0 15px gold;
}

.main{
    display:flex;flex-direction:column;gap:20px;align-items:center;
}

.upload-box{
    width:300px;height:300px;border-radius:24px;
    background:white;display:flex;align-items:center;justify-content:center;
    box-shadow:0 10px 30px rgba(0,0,0,.1);
    cursor:pointer;transition:.3s;position:relative;
}
.upload-box.drag{
    outline:4px dashed var(--accent);
    transform:scale(1.04);
}
.box-ui{
    width:100%;height:100%;border-radius:24px;
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    background-size:cover;background-position:center;
    color:#888;font-weight:600;
}

.piece{
    width:100px;height:100px;
    float:left;background-size:300px 300px;
    display:none;
}
body.puzzle-mode .piece{display:block;}
body.puzzle-mode .box-ui{display:none;}

button{
    padding:12px 28px;border:none;border-radius:999px;
    font-weight:600;cursor:pointer;
    background:var(--accent);color:white;
}
#saveBtn{display:none;background:var(--win);}

input{display:none;}
</style>
</head>

<body>

<div id="trophy-shelf"></div>

<div class="main">
    <div class="upload-box" id="dropZone">
        <div class="box-ui" id="boxUI">
            <div style="font-size:48px">ï¼‹</div>
            <div>drop or click image</div>
        </div>
    </div>

    <button onclick="togglePuzzle()">Split Image</button>
    <button onclick="startGame()">Play</button>
    <button id="saveBtn" onclick="saveTrophy()">Save Trophy</button>
</div>

<input type="file" id="fileInput" accept="image/*">

<script>
let solution=[],currentImg="";

const dz=document.getElementById("dropZone");
const ui=document.getElementById("boxUI");
const input=document.getElementById("fileInput");

/* CLICK UPLOAD */
dz.onclick=()=>input.click();
input.onchange=e=>loadFile(e.target.files[0]);

/* DRAG EVENTS */
dz.addEventListener("dragover",e=>{
    e.preventDefault();dz.classList.add("drag");
});
dz.addEventListener("dragleave",()=>dz.classList.remove("drag"));

dz.addEventListener("drop",e=>{
    e.preventDefault();dz.classList.remove("drag");

    if(e.dataTransfer.files.length){
        loadFile(e.dataTransfer.files[0]);
        return;
    }

    const url=e.dataTransfer.getData("text/uri-list");
    if(url) loadFromURL(url);
});

/* LOADERS */
function loadFile(file){
    const r=new FileReader();
    r.onload=e=>useImage(e.target.result);
    r.readAsDataURL(file);
}

function loadFromURL(url){
    const img=new Image();
    img.crossOrigin="anonymous";
    img.onload=()=>{
        const c=document.createElement("canvas");
        c.width=img.width;
        c.height=img.height;
        c.getContext("2d").drawImage(img,0,0);
        useImage(c.toDataURL("image/png"));
    };
    img.src=url;
}

/* GAME */
function useImage(data){
    currentImg=data;
    ui.style.backgroundImage=`url(${data})`;
    ui.innerHTML="";
    createPieces(data);
}

function createPieces(img){
    dz.querySelectorAll(".piece").forEach(p=>p.remove());
    solution=[];
    for(let i=0;i<9;i++){
        const p=document.createElement("div");
        p.className="piece";
        const pos=`${(i%3)*50}% ${Math.floor(i/3)*50}%`;
        solution.push(pos);
        p.style.backgroundImage=`url(${img})`;
        p.style.backgroundPosition=pos;
        p.draggable=true;

        p.ondragstart=e=>e.dataTransfer.setData("i",i);
        p.ondragover=e=>e.preventDefault();
        p.ondrop=e=>{
            e.preventDefault();
            const j=e.dataTransfer.getData("i");
            const other=dz.querySelectorAll(".piece")[j];
            [p.style.backgroundPosition,other.style.backgroundPosition]=
            [other.style.backgroundPosition,p.style.backgroundPosition];
            checkWin();
        };
        dz.appendChild(p);
    }
}

function togglePuzzle(){
    document.body.classList.toggle("puzzle-mode");
}

function startGame(){
    const pos=[...solution].sort(()=>Math.random()-.5);
    dz.querySelectorAll(".piece").forEach((p,i)=>p.style.backgroundPosition=pos[i]);
}

function checkWin(){
    const now=[...dz.querySelectorAll(".piece")].map(p=>p.style.backgroundPosition);
    if(JSON.stringify(now)===JSON.stringify(solution)){
        document.body.classList.add("won");
        document.getElementById("saveBtn").style.display="block";
    }
}

function saveTrophy(){
    const t=document.createElement("div");
    t.className="mini-trophy-item";
    t.style.backgroundImage=`url(${currentImg})`;
    document.getElementById("trophy-shelf").appendChild(t);
    document.body.classList.add("has-trophies");
}
</script>

</body>
</html>
